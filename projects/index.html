<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="https://eppie.dev/_next/static/css/d488f40addcdeb2f.css" as="style"/><link rel="stylesheet" href="https://eppie.dev/_next/static/css/d488f40addcdeb2f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://eppie.dev/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="https://eppie.dev/_next/static/chunks/webpack-df3790991e75ee53.js" defer=""></script><script src="https://eppie.dev/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="https://eppie.dev/_next/static/chunks/main-3536462487cd2cf1.js" defer=""></script><script src="https://eppie.dev/_next/static/chunks/pages/_app-6042b35e74b2fa9e.js" defer=""></script><script src="https://eppie.dev/_next/static/chunks/664-806b52bf69b97e98.js" defer=""></script><script src="https://eppie.dev/_next/static/chunks/73-490427e5710135f2.js" defer=""></script><script src="https://eppie.dev/_next/static/chunks/pages/projects-e8e9b282a78eafdd.js" defer=""></script><script src="https://eppie.dev/_next/static/6hqK1oc1TdkXSS38DBVaS/_buildManifest.js" defer=""></script><script src="https://eppie.dev/_next/static/6hqK1oc1TdkXSS38DBVaS/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><header class="header"><div class="container"><h1 class="title"><a href="/eppie.github.io">Andrew Epstein</a></h1><nav class="nav"><ul class="nav-list"><li class="nav-item"><a href="/eppie.github.io/about/">About</a></li><li class="nav-item"><a href="/eppie.github.io/projects/">Projects</a></li></ul></nav></div></header><div style="padding:20px"><h1>Fast DNA Complement Function</h1><p>In the course of manipulating genomic data, it is often desirable to compute the &quot;complement&quot; of a given sequence.</p><h3>Naive approach:</h3><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-cpp" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">void</span><span> </span><span class="token" style="color:#ffc66d">dnaComplement</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">char</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span>inputDNA</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#cc7832">int</span><span> length</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">for</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">int</span><span> i </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">;</span><span> i </span><span class="token" style="color:#a9b7c6">&lt;</span><span> length</span><span class="token" style="color:#a9b7c6">;</span><span> </span><span class="token" style="color:#a9b7c6">++</span><span>i</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">switch</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>inputDNA</span><span class="token" style="color:#a9b7c6">[</span><span>i</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">case</span><span> </span><span class="token" style="color:#6a8759">&#x27;A&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>                inputDNA</span><span class="token" style="color:#a9b7c6">[</span><span>i</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&#x27;T&#x27;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>                </span><span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">case</span><span> </span><span class="token" style="color:#6a8759">&#x27;T&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>                inputDNA</span><span class="token" style="color:#a9b7c6">[</span><span>i</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&#x27;A&#x27;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>                </span><span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">case</span><span> </span><span class="token" style="color:#6a8759">&#x27;C&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>                inputDNA</span><span class="token" style="color:#a9b7c6">[</span><span>i</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&#x27;G&#x27;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>                </span><span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">case</span><span> </span><span class="token" style="color:#6a8759">&#x27;G&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>                inputDNA</span><span class="token" style="color:#a9b7c6">[</span><span>i</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&#x27;C&#x27;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>                </span><span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">default</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>                </span><span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span></code></pre><h3>This approach:</h3><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-cpp" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">static</span><span> </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#cc7832">char</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span>arr</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">256</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token" style="color:#6a8759">&quot;TTTT&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#808080">/* omitted for brevity */</span><span> </span><span class="token" style="color:#6a8759">&quot;CCCC&quot;</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>        
<span>    </span><span class="token" style="color:#cc7832">uint8_t</span><span> </span><span class="token" style="color:#ffc66d">toIndex</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">uint32_t</span><span> input</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#cc7832">uint32_t</span><span> MASK </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6897bb">0x06060606</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">auto</span><span> x1 </span><span class="token" style="color:#a9b7c6">=</span><span> input </span><span class="token" style="color:#a9b7c6">&amp;</span><span> MASK</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">auto</span><span> x2 </span><span class="token" style="color:#a9b7c6">=</span><span> x1 </span><span class="token" style="color:#a9b7c6">&gt;&gt;</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">auto</span><span> x3 </span><span class="token" style="color:#a9b7c6">=</span><span> x2 </span><span class="token" style="color:#a9b7c6">|</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x2 </span><span class="token" style="color:#a9b7c6">&gt;&gt;</span><span> </span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">auto</span><span> x4 </span><span class="token" style="color:#a9b7c6">=</span><span> x3 </span><span class="token" style="color:#a9b7c6">|</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x3 </span><span class="token" style="color:#a9b7c6">&gt;&gt;</span><span> </span><span class="token" style="color:#6897bb">4</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">return</span><span> x4</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>    
<span>    </span><span class="token" style="color:#ffc66d">__attribute__</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span>noinline</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">void</span><span> </span><span class="token" style="color:#ffc66d">dnaComplement</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">char</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span>inputDNA</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#cc7832">int</span><span> length</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">for</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">int</span><span> i </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">;</span><span> i </span><span class="token" style="color:#a9b7c6">&lt;</span><span> length</span><span class="token" style="color:#a9b7c6">;</span><span> i </span><span class="token" style="color:#a9b7c6">+=</span><span> </span><span class="token" style="color:#6897bb">4</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">uint32_t</span><span> input </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">uint32_t</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">(</span><span>inputDNA </span><span class="token" style="color:#a9b7c6">+</span><span> i</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">uint8_t</span><span> index </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#ffc66d">toIndex</span><span class="token" style="color:#a9b7c6">(</span><span>input</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#cc7832">char</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span>complement </span><span class="token" style="color:#a9b7c6">=</span><span> arr</span><span class="token" style="color:#a9b7c6">[</span><span>index</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>            </span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">uint32_t</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">(</span><span>inputDNA </span><span class="token" style="color:#a9b7c6">+</span><span> i</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">uint32_t</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">)</span><span>complement</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span></code></pre><p>And here&#x27;s how the `toIndex` function works:</p><input type="text" style="padding:10px;font-size:16px;width:100%;box-sizing:border-box" placeholder="Enter text here" value="ACTG"/><div style="margin-top:20px;font-size:18px;border:1px solid black;padding:10px;display:flex;flex-wrap:wrap"><div>Input:<div style="display:flex;align-items:center"></div></div><div>Mask:<div style="display:flex;align-items:center"></div></div><div>x1 = input &amp; mask:<div style="display:flex;align-items:center"></div></div><div>x2 = x1 <!-- -->&gt;&gt;<!-- --> 1:<div style="display:flex;align-items:center"></div></div><div>x3 = x2 | (x2 <!-- -->&gt;&gt;<!-- --> 14):<div style="display:flex;align-items:center"></div></div><div>x4 = x3 | (x3 <!-- -->&gt;&gt;<!-- --> 4):<div style="display:flex;align-items:center"></div></div></div></div><footer class="footer"><div class="container"><p><a href="/eppie.github.io">© 2024 Andrew Epstein</a></p><ul class="social-links"><li><a href="https://www.linkedin.com/in/andrew-epstein/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li><li><a href="https://github.com/Eppie" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/projects","query":{},"buildId":"6hqK1oc1TdkXSS38DBVaS","assetPrefix":"https://eppie.dev","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>